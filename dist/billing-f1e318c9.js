(window.webpackJsonpCheckout=window.webpackJsonpCheckout||[]).push([[4],{1648:function(e,t,s){"use strict";s.r(t);var n=s(3),a=s(15),r=s(0),i=s.n(r),d=s(1636),o=s(1534),l=s(434),c=s(1447),u=s(435),g=s(1587),m=s(1480),h=s(1472),p=s(1640);function b(e){var t=Object(p.a)(e);return t&&["amazonpay"].indexOf(t.providerId)>-1?t.providerId:void 0}var f=s(115),A=s(71),v=s(1637),C=s(1638),O=s(1646),_=s(670),j=s(673),y=s(669),S=s(315),E=s(1639),k=s(1471),w=s(1478),F=s(1479),I=s(1456),U=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isResettingAddress:!1},t.addressFormRef=Object(r.createRef)(),t.handleSelectAddress=function(e){return Object(n.__awaiter)(t,void 0,void 0,(function(){var t,s,a,r;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:t=this.props,s=t.updateAddress,a=t.onUnhandledError,this.setState({isResettingAddress:!0}),n.label=1;case 1:return n.trys.push([1,3,4,5]),[4,s(e)];case 2:return n.sent(),[3,5];case 3:return r=n.sent(),a(r),[3,5];case 4:return this.setState({isResettingAddress:!1}),[7];case 5:return[2]}}))}))},t.handleUseNewAddress=function(){t.handleSelectAddress({})},t}return Object(n.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.googleMapsApiKey,s=e.billingAddress,n=e.countriesWithAutocomplete,a=e.customer,r=a.addresses,d=a.isGuest,o=e.getFields,l=e.countries,c=e.isUpdating,g=e.setFieldValue,m=e.shouldShowOrderComments,p=e.values,b="amazonpay"===e.methodId,f=o(p.countryCode),A=f.filter((function(e){return e.custom})),_=A.length>0,j=b&&_?A:f,y=this.state.isResettingAddress,S=r&&r.length>0,U=s&&Object(v.a)(s,r,o(s.countryCode));return i.a.createElement(w.a,{autoComplete:"on"},b&&s&&i.a.createElement("div",{className:"form-fieldset"},i.a.createElement(I.a,{address:s})),i.a.createElement(F.a,{id:"checkoutBillingAddress",ref:this.addressFormRef},S&&!b&&i.a.createElement(F.a,{id:"billingAddresses"},i.a.createElement(h.a,{isLoading:y},i.a.createElement(C.a,{addresses:r,onSelectAddress:this.handleSelectAddress,onUseNewAddress:this.handleUseNewAddress,selectedAddress:U?s:void 0}))),!U&&i.a.createElement(h.a,{isLoading:y},i.a.createElement(O.a,{countries:l,countriesWithAutocomplete:n,countryCode:p.countryCode,formFields:j,googleMapsApiKey:t,setFieldValue:g,shouldShowSaveAddress:!d}))),m&&i.a.createElement(E.a,null),i.a.createElement("div",{className:"form-actions"},i.a.createElement(k.c,{disabled:c||y,id:"checkout-billing-continue",isLoading:c||y,type:"submit",variant:k.b.Primary},i.a.createElement(u.a,{id:"common.continue_action"}))))},t}(r.PureComponent),z=Object(S.a)(Object(f.withFormik)({handleSubmit:function(e,t){(0,t.props.onSubmit)(e)},mapPropsToValues:function(e){var t=e.getFields,s=e.customerMessage,a=e.billingAddress;return Object(n.__assign)(Object(n.__assign)({},Object(_.a)(t(a&&a.countryCode),a)),{orderComment:s})},isInitialValid:function(e){var t=e.billingAddress,s=e.getFields,n=e.shouldValidateSafeInput,a=e.language;return!!t&&Object(j.a)({language:a,shouldValidateSafeInput:n,formFields:s(t.countryCode)}).isValidSync(t)},validationSchema:function(e){var t=e.language,s=e.getFields,n=e.methodId,a=e.shouldValidateSafeInput;return"amazonpay"===n?Object(A.lazy)((function(e){return Object(y.a)({translate:Object(j.b)(t),formFields:s(e&&e.countryCode)})})):Object(A.lazy)((function(e){return Object(j.a)({language:t,shouldValidateSafeInput:a,formFields:s(e&&e.countryCode)})}))},enableReinitialize:!0})(U)),M=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleSubmit=function(e){return Object(n.__awaiter)(t,void 0,void 0,(function(){var t,s,a,r,i,l,c,u,g,m,h=e.orderComment,p=Object(n.__rest)(e,["orderComment"]);return Object(n.__generator)(this,(function(e){switch(e.label){case 0:t=this.props,s=t.updateAddress,a=t.updateCheckout,r=t.customerMessage,i=t.billingAddress,l=t.navigateNextStep,c=t.onUnhandledError,u=[],(g=Object(d.a)(p))&&!Object(o.a)(g,i)&&u.push(s(g)),r!==h&&u.push(a({customerMessage:h})),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,Promise.all(u)];case 2:return e.sent(),l(),[3,4];case 3:return m=e.sent(),c(m),[3,4];case 4:return[2]}}))}))},t}return Object(n.__extends)(t,e),t.prototype.componentDidMount=function(){return Object(n.__awaiter)(this,void 0,void 0,(function(){var e,t,s,r,i,d;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:e=this.props,t=e.initialize,s=e.onReady,r=void 0===s?a.noop:s,i=e.onUnhandledError,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,t()];case 2:return n.sent(),r(),[3,4];case 3:return d=n.sent(),i(d),[3,4];case 4:return[2]}}))}))},t.prototype.render=function(){var e=this.props,t=e.updateAddress,s=e.isInitializing,a=Object(n.__rest)(e,["updateAddress","isInitializing"]);return i.a.createElement("div",{className:"checkout-form"},i.a.createElement("div",{className:"form-legend-container"},i.a.createElement(m.a,{testId:"billing-address-heading"},i.a.createElement(u.a,{id:"billing.billing_address_heading"}))),i.a.createElement(h.a,{isLoading:s,unmountContentWhenLoading:!0},i.a.createElement(z,Object(n.__assign)({},a,{onSubmit:this.handleSubmit,updateAddress:t}))))},t}(r.Component);t.default=Object(l.a)((function(e){var t=e.checkoutService,s=e.checkoutState,n=s.data,a=n.getCheckout,r=n.getConfig,i=n.getCart,d=n.getCustomer,o=n.getBillingAddress,l=n.getBillingAddressFields,u=n.getBillingCountries,m=s.statuses,h=m.isLoadingBillingCountries,p=m.isUpdatingBillingAddress,f=m.isUpdatingCheckout,A=r(),v=d(),C=a(),O=i();if(!(A&&v&&C&&O))return null;var _=A.checkoutSettings,j=_.enableOrderComments,y=_.googleMapsApiKey,S=_.features,E=["US","CA","AU","NZ"];return S["CHECKOUT-4183.checkout_google_address_autocomplete_uk"]&&E.push("GB"),{billingAddress:o(),countries:u()||c.a,countriesWithAutocomplete:E,customer:v,shouldValidateSafeInput:S["CHECKOUT-5327.validate_checkout_values"],customerMessage:C.customerMessage,getFields:l,googleMapsApiKey:y,initialize:t.loadBillingAddressFields,isInitializing:h(),isUpdating:p()||f(),methodId:b(C),shouldShowOrderComments:j&&Object(g.a)(O)<1,updateAddress:t.updateBillingAddress,updateCheckout:t.updateCheckout}}))(M)}}]);
//# sourceMappingURL=billing-f1e318c9.js.map